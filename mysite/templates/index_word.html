{% extends 'index_nav_word.html' %}
{% block content %}
<head><link href="/static/style_word2.css" rel="stylesheet"/></head>
<!-- Masthead-->
<header>
    <div class="container">
<!--        <div class="masthead-subheading">Welcome To Our Studio!</div>-->
<!--        <div class="masthead-heading text-uppercase">It's Nice To Meet You</div>-->
<!--        <a class="btn btn-primary btn-xl text-uppercase" href="#services">Tell Me More</a>-->
    </div>
</header>

<!-- Button_zip-->
<!--<div class="btn_zip" style="top:40%;">-->
<!--    <a id="themebtn1" class="text-center btn btn-primary btn-xl text-uppercase"-->
<!--       style="color:black; line-height: 13px; margin-bottom: 10px;"-->
<!--       href="{% url 'main:word_create_f' %}">과일</a>-->
<!--    <a id="themebtn2" class="text-center btn btn-primary btn-xl text-uppercase"-->
<!--       style="color:black; line-height: 13px; margin-bottom: 10px;"-->
<!--       href="{% url 'main:word_create_a' %}">동물</a>-->
<!--    <a id="themebtn3" class="text-center btn btn-primary btn-xl text-uppercase"-->
<!--       style="color:black; line-height: 13px; margin-bottom: 50px;"-->
<!--       href="{% url 'main:word_create_p' %}">식물</a>-->
<!--    <form id="upload-form" method="POST" enctype="multipart/form-data">-->
<!--        {% csrf_token %}-->
<!--        <button id="upload-button" class="text-center btn btn-primary btn-xl text-uppercase"-->
<!--                style="color:black; line-height: 13px; margin-bottom: 10px;" type="submit">-->
<!--            제출하기-->
<!--        </button>-->
<!--    </form>-->
<!--    <a class="text-center btn btn-primary btn-xl text-uppercase"-->
<!--       style="color:black; line-height: 13px; margin-bottom: 10px;"-->
<!--       href="{% url 'main:word_result' %}">점수보기</a>-->


<div  style="margin-bottom: 10px; position: relative;">
    <button class="jsColor fixed-color controls__colors" id="jsMode"
            style="background-color: black; float: left; display:none;  color:white; z-index: 1;">
        연필
    </button>
    <button class="jsColor fixed-color controls__colors" id="jsMode1"
            style="background-color: white; float: left; z-index: 1;">지우개</button>
</div>


<!--</div>-->
<form action="{% url 'main:word_test' %}">
    <button id="upload-button2" type="submit" style="display:none; position: absolute; top: 900px;">Upload2</button>
</form>



<!--        단어장-->
<section class="page-section" id="diary" style="height:80vh;">
    <div class="container">
        <div class="text-center">
            <h2 class="section-heading text-uppercase" id="chocho">퀴즈 준비중 ...</h2>
            <h3 class="section-subheading text-muted">천천히 생각해보세요.</h3>
        </div>
        <div class="canvas-container  d-flex justify-content-center align-items-center">
            <canvas id="jsCanvas" class="canvas"></canvas>
            <canvas id="canvas_top" class="canvas_top"></canvas>
        </div>
    </div>
</section>



<!-- Portfolio Grid-->
<section class="page-section bg-light" id="portfolio" style="display: none;">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-sm-6">
                <!-- Portfolio item 6-->
                <div class="portfolio-item">
                    <a class="portfolio-link" data-bs-toggle="modal" href="#portfolioModal6" id="contact_word">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content"><i class="fas fa-plus fa-3x"></i></div>
                        </div>
                        <img class="img-fluid" src="/static/assets/img/portfolio/6.jpg" alt="..."/>
                    </a>
                    <div class="portfolio-caption">
                        <div class="portfolio-caption-heading">Window</div>
                        <div class="portfolio-caption-subheading text-muted">Photography</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Portfolio item 6 modal popup-->
<div class="portfolio-modal modal" id="portfolioModal6" tabindex="-1" role="dialog" aria-hidden="true" style="width: 800px; height: 390px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, 20%);">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="modal-body">
                            <!-- Project details-->
                            <h2 class="text-uppercase">{{result}}</h2>
                            <button class="btn btn-primary btn-xl text-uppercase" data-bs-dismiss="modal" type="button" id="contact_word2" style="display: none;">
                                <i class="fas fa-xmark me-1"></i>
                                Close Project
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="/static/js/scripts.js"></script>
<script src="/static/app_word.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<!-- * *                               SB Forms JS                               * *-->
<!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
<script type="text/javascript">
    const uploadButton = document.querySelector('#upload-button');
    const uploadButton2 = document.querySelector('#upload-button2');

    document.addEventListener('DOMContentLoaded', () => {
      const uploadButton = document.querySelector('#upload-button');
      const uploadButton2 = document.querySelector('#upload-button2');

      uploadButton.addEventListener('click', () => {
        setTimeout(() => {
          uploadButton2.click();
        }, 100);
      });
    });

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  window.onload = function() {
    setTimeout(function() {
      var chocho = document.getElementById('chocho');
      chocho.textContent = "{{theme}}초성: {{cho}}";
    }, 2000);
  };
</script>
<script>
  function uploadImageToServer(imageData) {
    var formData = new FormData();
    formData.append('image_data', imageData);

    $.ajax({
      url: '/main/upload/',
      type: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      beforeSend: function(xhr, settings) {
        // CSRF 토큰 설정
        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
      },
      success: function(response) {
<!--        alert('Image uploaded successfully!');-->
            console.log("성공")
      },
      error: function(xhr, status, error) {
<!--        alert('Image upload failed. Please try again.');-->
            console.log("실패")
      }
    });
  }

  $(document).ready(function() {
    $('#upload-form').submit(function(event) {
      event.preventDefault();  // 기본 동작(폼 전송) 방지
      var canvas = document.getElementById('jsCanvas');
      var context = canvas.getContext('2d');
      var imageData = canvas.toDataURL('image/jfif');

      // 이미지 데이터 서버로 전송
      uploadImageToServer(imageData);
    });
  });

</script>
{% if result %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('contact_word').click();

        setTimeout(function() {
            document.getElementById('contact_word2').click();
        }, 2000);
    });
</script>
{% endif %}
<script>
// 드래그 앤 드롭 기능 구현
var dragItems = document.querySelectorAll('.controls__colors');
var isDragging = false;

// 버튼 요소에 대해 이벤트 리스너 등록
dragItems.forEach(function(dragItem) {
  dragItem.addEventListener('mousedown', function(e) {
    e.preventDefault();
    var initialX = e.clientX - dragItem.offsetLeft;
    var initialY = e.clientY - dragItem.offsetTop;

    isDragging = true;

    // 마우스 이동 이벤트 리스너
    document.addEventListener('mousemove', moveItem);

    // 마우스 업 이벤트 리스너
    document.addEventListener('mouseup', function() {
      document.removeEventListener('mousemove', moveItem);
      isDragging = false;
    });

    // 요소 이동 함수
    function moveItem(e) {
      if (!isDragging) return;

      var newX = e.clientX - initialX;
      var newY = e.clientY - initialY;

      // 모든 버튼 요소들의 위치 설정
      dragItems.forEach(function(item) {
        item.style.left = newX + 'px';
        item.style.top = newY + 'px';
      });
    }
  });
});
</script>
</body>
</html>
{% endblock %}